---
title: User sessions and sudo usage
---


- We can run commands as other users from our login session. When we do this, a new user session is opened. Run a command as `testuser`

  ```
  $ su - testuser -c "whoami"
  Password: 
  testuser
  ```

- Now check the auth log file to see if this activity is logged.

  ```execute
  tail  /var/log/auth.log
  ```

  You should get output similar to the following:

  ```
  Oct 30 21:55:49 <hostname> su: (to testuser) user1 on pts/1
  Oct 30 21:55:49 <hostname> su: pam_unix(su-l:session): session opened for user testuser(uid=1001) by (uid=1000)
  Oct 30 21:55:50 <hostname> su: pam_unix(su-l:session): session closed for user testuser
  ```

  - The first line of log above shows that `user1` first attempted to use the `su` utility to switch to `testuser`.
  - The second line shows that the session was opened.
  - The third line shows that the session was closed. This happened after the command finished executing.

- Sudo usage logs are also saved in `/var/log/auth.log`. When a user runs `sudo`, they open a sudo session.

- Filter the log file for `sudo`. Run the following command:

  ```execute
  sudo ip a
  ```

- View the log file using `tail  /var/log/auth.log` You should get output siilar to the following:

  ```
  Oct 30 22:03:20 sna-vm sudo:    user1 : TTY=pts/0 ; PWD=/home/user1 ; USER=root ; COMMAND=/usr/sbin/ip a
  Oct 30 22:03:20 sna-vm sudo: pam_unix(sudo:session): session opened for user root(uid=0) by (uid=1000)
  Oct 30 22:03:20 sna-vm sudo: pam_unix(sudo:session): session closed for user root
  ```

- When a user attempts to use sudo to execute a command as `root`, that command is logged to the auth file as seen in the first line of the output above.

- Filter the log to view all attempts made to execute commands as `root`

  ```execute
  cat /var/log/auth.log | grep -P "USER=root.*COMMAND="
  ```

  You should get output similar to the following:

  ```
  Oct 30 21:15:23 sna-vm sudo:    user1 : TTY=pts/0 ; PWD=/home/user1 ; USER=root ; COMMAND=/usr/bin/bash track_auth_fail.sh
  Oct 30 21:47:54 sna-vm sudo:    user1 : TTY=pts/1 ; PWD=/home/user1 ; USER=root ; COMMAND=/usr/sbin/ip a
  Oct 30 22:03:20 sna-vm sudo:    user1 : TTY=pts/0 ; PWD=/home/user1 ; USER=root ; COMMAND=/usr/sbin/ip a
  Oct 30 22:07:25 sna-vm sudo:    user1 : 3 incorrect password attempts ; TTY=pts/4 ; PWD=/home/user1 ; USER=root ; COMMAND=/usr/sbin/ip a
  ```
