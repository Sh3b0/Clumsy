---
title: Package Managers
---

A package manager automates the process of installing, configuring, upgrading, and removing packages. There are several package managers depending on the OS. This exercise focuses on Ubuntu package managers.

> Note that Ubuntu is based on the Debian distro and it uses the same APT packaging system as Debian and shares a huge number of packages and libraries from Debian repositories.

### Part 1: dpkg

`dpkg` is a tool that allows the installation and analysis of `.deb` packages. It can also be used to package software.

- View a list of all installed packages using `dpkg -l`. You should get an output similar to the following:
  ![img](https://i.imgur.com/Te0ZnIm.png)

- Install a local `.deb` file using the command `dpkg -i <deb-package>`. Let’s download and install Google Chrome browser

  ```execute
  wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
  dpkg -i google-chrome-stable_current_amd64.deb
  ```

- Verify the package installation using `dpkg -s <deb-package>`

  ```execute
  dpkg -s google-chrome-stable
  ```

  You get an output similar to the following

  ```
  Package: google-chrome-stable
  Status: install ok installed
  Priority: optional
  Section: web
  Installed-Size: 299404
  Maintainer: Chrome Linux Team <chromium-dev@chromium.org>
  Architecture: amd64
  Version: 107.0.5304.87-1
  Provides: www-browser
  Depends: ca-certificates, fonts-liberation, libasound2 (>= 1.0.17), libatk-bridge2.0-0 (>= 2.5.3), libatk1.0-0 (>= 2.2.0), libatspi2.0-0 (>= 2.9.90), libc6 (>= 2.17), libcairo2 (>= 1.6.0), libcups2 (>= 1.6.0), libcurl3-gnutls | libcurl3-nss | libcurl4 | libcurl3, libdbus-1-3 (>= 1.5.12), libdrm2 (>= 2.4.60), libexpat1 (>= 2.0.1), libgbm1 (>= 8.1~0), libglib2.0-0 (>= 2.39.4), libgtk-3-0 (>= 3.9.10) | libgtk-4-1, libnspr4 (>= 2:4.9-2~), libnss3 (>= 2:3.26), libpango-1.0-0 (>= 1.14.0), libwayland-client0 (>= 1.0.2), libx11-6 (>= 2:1.4.99.1), libxcb1 (>= 1.9.2), libxcomposite1 (>= 1:0.4.4-1), libxdamage1 (>= 1:1.1), libxext6, libxfixes3, libxkbcommon0 (>= 0.4.1), libxrandr2, wget, xdg-utils (>= 1.0.2)
  Pre-Depends: dpkg (>= 1.14.0)
  Recommends: libu2f-udev, libvulkan1
  Description: The web browser from Google
   Google Chrome is a browser that combines a minimal design with sophisticated technology to make the web faster, safer, and easier.
  ```

- List all files installed by a package with the command `dpkg -L <package-name>`

  ```execute
  dpkg -L google-chrome-stable
  ```

- Remove a package using `dpkg -r <package-name>`

  ```execute
  dpkg -r google-chrome-stable
  ```

- Check the status of the package again and you should see that it is in the `deinstall` state, but the configuration files are still present.

  ```execute
  sudo dpkg -s google-chrome-stable
  ```

  The `-r` option simply removes the package but all the configuration files are preserved.

- To remove a package along with its configuration files, specify the `--purge` option.

  ```execute
  sudo dpkg --purge google-chrome-stable
  ```

- Check the status of the package to verify that the package and all its configuration files have been removed.

  ```execute
  sudo dpkg -s google-chrome-stable
  ```

### Part 2: APT

The Advanced Packaging Tools (APT) is a package manager on Ubuntu systems. `apt` acts as a user friendly tool that interacts with `dpkg`. Unlike `dpkg`, `apt` allows download and installation of packages from online repositories.

- View all available packages in your repository using `apt list`

- To list only installed packages, use `apt list --installed`

- Search for a package using `apt search`.

  ```execute
  apt search chromium
  ```

- After knowing the correct package name, you can find out more details about the package using `apt show`

  ```execute
  apt show chromium-browser
  ```

- Proceed to install the package using `apt install`

  ```execute
  sudo apt install chromium-browser
  ```

- Remove a package using `apt remove`

  ```execute
  sudo apt remove chromium-browser
  ```

  > You can install or remove multiple packages in one command by separating them by spaces. e.g `apt install package1 package2 package3`.
  > To remove multiple packages is similar e.g `apt remove package1 package2 package3`.

- Specify the `remove` option in combination with the `--purge` option to remove a package along with its configuration.

  ```execute
  sudo apt remove --purge chromium-browser
  ```

- Specify `autoremove` to remove the package and its dependencies, if not used by any other application. The format is shown below:

  ```copy-and-edit
  sudo apt autoremove <package-name>
  ```

  > `apt autoremove` without a package name will remove unused dependencies and free space. 

- You can update the APT package index to get a list of the available packages. This list can indicate installed packages that need upgrading, as well as new packages that have been added to the repositories. The repositories are defined in the `/etc/apt/sources.list` file and in the `/etc/apt/sources.list.d` directory.

- View the `sources.list` file to see all the defined repositories.

  ```execute
  cat /etc/apt/sources.list
  ```

- To update the local package index with latest updates to repositories, use the following command:

  ```execute
  sudo apt update
  ```

- APT maintains a list of packages (package index) in `/var/lib/apt/lists/`

  ```execute
  ls -lah /var/lib/apt/lists/
  ```

- To upgrade a single package that has been previously installed, run the `apt install <package-name>` command.

- To upgrade all installed packages, run the following command:

  ```execute
  sudo apt upgrade
  ```

  This command will upgrade all packages that can be upgraded without installing additional packages or removing conflicting installed packages.

- Run `apt full-upgrade` to upgrade the packages, the kernel, and remove conflicting packages or install new ones. The `full-upgrade` option is “smart” and can remove unnecessary dependency packages, or install new ones (if required).

### Part 3: sources.list

- View the `sources.list`file without the comments

  ```execute
  grep -o '^[^#]*' /etc/apt/sources.list
  ```

- Each line in the `sources.list` has a structure in the following order:

  ```
  Type	URL	Distribution	Component
  ```

- Let’s analyze the first line in the `sources.list` above.

  - The **Type** is `deb`. The term `deb` indicates that it is a repository of binaries.
  - The repository **URL** is `http://ru.archive.ubuntu.com/ubuntu/`. This is the location of the repository where the packages will be downloaded.
  - The **Distribution** is `jammy`. This is the short code name of the release. Run `$ cat /etc/os-release` to view the `VERSION_CODENAME` of your system.
  - The Components are `main` and `restricted`. These are information about the licensing of the packages in the repository.
    - `main` contains Canonical supported free and open source software.
    - `restricted` contains proprietary drivers for devices.
    - `universe` contains community supported free and open source software.
    - `multiverse` contains software restricted by copyright or legal issues.

### Part 4: Adding repositories

- Let’s try to install a package that is not in Ubuntu repository by default. Try installing MongoDB using `apt install mongo-db`. You should get an output similar to the following

  ```
  Reading package lists... Done
  Building dependency tree... Done
  Reading state information... Done
  E: Unable to locate package mongodb-org
  ```

- We need to add the MongoDB repository to our repository sources. The basic syntax of the add-apt-repository command is as follows:

  ```copy-and-edit
  add-apt-repository [options] repository
  ```

- The `repository` can be a regular repository entry that can be added to `sources.list` in the format 

  ```
  deb http://ru.archive.ubuntu.com/ubuntu/ distro component
  ```

- Or a PPA repository in the `ppa:<user>/<ppa-name>` format

- First import MongoDB PGP key. The key is used to verify the integrity of packages that are downloaded from this repository.

  ```execute
  curl -fsSL https://www.mongodb.org/static/pgp/server-6.0.asc | sudo gpg --dearmor -o /etc/apt/trusted.gpg.d/mongodb-6.gpg
  ```

- Create a list for MongoDB

  ```execute
  add-apt-repository 'deb [ arch=amd64,arm64 ] https://repo.mongodb.org/apt/ubuntu focal/mongodb-org/6.0 multiverse'
  ```

  > Alternatively, you can manually create the list file and add the repository to it.
  >
  > ```execute
  > echo "echo "deb [ arch=amd64,arm64 ] https://repo.mongodb.org/apt/ubuntu focal/mongodb-org/6.0 multiverse" | sudo tee /etc/apt/sources.list.d/mongodb-org-6.0.list
  > ```

- View the new list file that has been created

  ```execute
  cat /etc/apt/sources.list.d/*mongodb*.list
  ```

- The `add-apt-repository` command automatically updates the local package database for you. If you added the repository via an alternative means, you need to run `apt update` to update the local package database.

- View the package index directory to see the MongoDB related files created.

  ```execute
  ls -lah /var/lib/apt/lists/ | grep mongodb
  ```

  > MongoDB requires `libssl1.1 (>= 1.1.1)`. So let’s download and install this package before proceeding
  >
  > ```execute
  > wget http://archive.ubuntu.com/ubuntu/pool/main/o/openssl/libssl1.1_1.1.1f-1ubuntu2.16_amd64.deb
  > dpkg -i ./libssl1.1_1.1.1f-1ubuntu2.16_amd64.deb
  > ```

- You can now proceed to install MongoDB from the newly enabled repository.

  ```execute
  sudo apt install mongodb-org
  ```

  > You can answer the prompt that asks you to type `Y` to verify your choice by adding the option `-y` to your install command in the format `apt install mongodb-org -y`. This is very useful when writing scripts that install packages.

- Verify that MongoDB has been installed

  ```execute
  mongod --version
  ```

- You can remove a previously enabled repository using the format 

  ```execute
  add-apt-repository --remove repository
  ```

- Let’s remove the MongoDB repository

  ```execute
  add-apt-repository --remove 'deb [ arch=amd64,arm64 ] https://repo.mongodb.org/apt/ubuntu focal/mongodb-org/6.0 multiverse'
  ```

- Run the following commands to verify that the repository has been removed.

  ```execute
  ls -lah /var/lib/apt/lists/ | grep mongodb
  cat /etc/apt/sources.list.d/*mongodb*.list
  ```

- You can use `apt purge` to remove a package along with its configuration

  ```execute
  sudo apt purge mongodb-org
  ```

### Part 5: Creating a custom Ubuntu package

- Create a directory for the package. We will name the package `test`

  ```execute
  mkdir test_package
  ```

- Create the internal structure by placing your program files where they should be installed to on the target system. In this case, we want to place the program file in `/usr/local/bin` on the target system, therefore we create the directory `test/usr/local/bin`

  ```execute
  mkdir -p test_package/usr/local/bin
  ```

- Create the program file (script) `nano test_package/usr/local/bin/script` and add the following to it.

  ```copy
  #!/bin/bash
  echo "Hello World!"
  ```

- Give the program file execute permission

  ```execute
  chmod +x test_package/usr/local/bin/test_package
  ```

- Create a directory `DEBIAN` in the package directory

  ```execute
  mkdir test_package/DEBIAN
  ```

- Create the control file in the `DEBIAN` directory. The control file contains package description and information about the maintainer. Create the file `test/DEBIAN/control` and add the following content.

  ```
  Package: test_package
  Version: 1.0
  Maintainer: <username>
  Architecture: all
  Description: Test Script
  ```

  > These are mandatory fields in the control file. There are several other fields that can be defined.

- Build the package with 

  ```execute
  dpkg-deb --build --root-owner-group test_package
  ```

  > The `--root-owner-group` flag makes all deb package content owned by the root user. Without this flag, all files and folders would be owned by your user, which might not exist in the target system the deb package would be installed to.

- You should have a debian package in your current working directory named `test_package.deb`. Proceed to install this package.

  ```execute
  dpkg -i test_package.deb
  ```

- You should get an output similar to the following

  ```
  Selecting previously unselected package test_package.
  (Reading database ... 195723 files and directories currently installed.)
  Preparing to unpack test_package.deb ...
  Unpacking test_package (1.0) ...
  Setting up test_package (1.0) ...
  ```

- Run the newly installed package. You can have a compiled application in place of the script we have used.

  ```execute
  test_package
  ```
