---
title: Text Filtration
---

- Copy `/etc/passwd` to your current directory

  ```execute
  cp /etc/passwd ./passwd
  ```

### Part 1: grep

The `grep` command searches for lines matching a pattern and prints the matching lines to output.

- View all occurrences of “systemd” in the `passwd` file.

  ```execute
  grep "systemd" passwd
  ```

  Sample output:

  ```bash
  systemd-network:x:100:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin
  systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin
  systemd-timesync:x:102:104:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin
  systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin
  ```

- Show line number of the matches.

  ```execute
  grep -n "systemd" passwd
  ```

- Invert the match to show lines without “systemd”. This is done with the `-v` option.

  ```execute
  grep -v "systemd" passwd
  ```

- It is also necessary in some cases to print the lines before or after a match.

  - Print 5 lines after the match.

    ```execute
    grep -A 5 "systemd" passwd
    ```

  - Print 3 lines before the match.

    ```execute
    grep -B 3 "systemd" passwd
    ```

  - Use the `-C` option to print 5 lines before and after a match.

    ```execute
    grep -C 5 "systemd" passwd
    ```

- Specify the `-P` option to use PCRE (Perl Compatible Regular Expression).

  ```execute
  grep -P "(systemd|root)" passwd
  ```

- Practice: save the following lines to a file `regextest.txt` and try to match all the fields.

  ```bash
  03/22 08:51:06 INFO   :...read_physical_netif: index #0, interface VLINK1 has address 129.1.1.1, ifidx 0
  03/22 08:51:06 ERROR   :...read_physical_netif: index #4, interface CTCD0 has address 9.67.116.98, ifidx 4
  ```

  > Regex [crash course](https://ryanstutorials.net/regular-expressions-tutorial/), [cheat sheet](https://quickref.me/grep), and [experimentation environment](https://regex101.com)

### Part 2: awk

AWK is a language designed for text processing and typically used as a data extraction and reporting tool. It can be uses like sed and grep to filter data with additional capabilities. It is a standard feature of most Unix-like operating systems.

- awk can be used like grep. The syntax is shown

  ```execute
  awk '/systemd/{print $0}' passwd
  ```

- We can use the `gsub` method to substiture all occurrences of systemd

  ```execute
  awk '{gsub(/systemd/, "NEWSYSTEMD")}{print}' passwd
  ```

- Add header and footer to the text document

  ```execute
  awk 'BEGIN {print "PASSWD FILE\n--------------"} {print} END {print "--------------\nEND OF PASSWD FILE"}' passwd
  ```

- We can specify delimiters to separate fields in a string. In the example below, we use `:` as the delimiter

  ```execute
  awk -F ":" '{print $1, $6, $7}' passwd
  ```

- Numeric comparison is possible with awk.

  ```execute
  awk -F ":" '{ if ($3 > 100) {print $0} }' passwd
  ```

### Part 3: sed

The sed command (short for stream editor) performs editing operation on text coming from standard input or file. The sed command can be used like grep but it has more functionalities.

- Sed by default will output the entire content of the file even when there is a match.

  ```execute
  sed '/systemd/p' passwd
  ```

  > The pattern we are searching for is enclosed in the `/.../`. In this case, we are searching for “systemd”.
  > The enclosed pattern is followed by a `p` command so that sed will print the line to standard output.

- Now, let’s use sed like grep. To print only the lines that match, we add the `-n` option.

  ```execute
  sed -n '/systemd/p' passwd
  ```

- Sed can substitute a matched pattern with another string before an output is displayed. It follows the structure `s/pattern/replacement/`.
  In the output, replace “systemd” with “NEWSYSTEMD”

  ```execute
  sed -n 's/systemd/NEWSYSTEMD/p' passwd
  ```

- In case you want to output all contents of the file to another file while replacing “systemd”, you can remove the `-n` option. Analyse the output from:

  ```execute
  sed 's/systemd/NEWSYSTEMD/' passwd
  ```

- We can restrict sed to perform it’s operation on a specific line number. In the example below, we restrict sed to line 1.

  ```execute
  sed '1 s/root/NOTROOT/' passwd
  ```

- We can specify a range of line numbers.

  ```execute
  sed '2,4 s/bin/NOBIN/g' passwd
  ```

  > `g` stands for global, which means that all matching occurrences in the line would be replaced. By default, sed will replace only the first occurrence in the line.

- We can also specify the line number where the match should start from. Sed will terminate when the first match is found.

  ```execute
  sed -n '5,/systemd/p' passwd
  ```

- Search for the word “sda” and replace it with “hda” globally (s/regexp/replacement/g), when the line contains the key “efi” (/regexp/) in the file fstab

  ```execute
  sed '/efi/ s/sda/hda/g' fstab
  ```

- Search for the word “:” and replace it with “;” when the line contains the key “root” in file passwd

  ```execute
  sed '/root/ s/:/;/g' passwd
  ```

- Create the following file called unique with the following content

  ```execute
  nano unique.txt
  ```

  ```
  This line occurs only once. 
  This line occurs twice.
  This line occurs twice.
  This line occurs three times. 
  This line occurs three times. 
  This line occurs three times.
  ```

- Delete line 2 and 3 from the file unique

  ```execute
  sed '2,3 d' unique.txt
  ```

- Delete all line that starts with “This”

  ```execute
  sed '/^This/ d' unique.txt
  ```
